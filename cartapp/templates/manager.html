{% extends 'base.html' %}

{% block title %}
    购物车页面
{% endblock %}

{% block main %}

		<div class="cart">
			<br>
			<div class="carthead">
				<ul>
					<li><input type="checkbox" checked="true" class="checa" onclick="allsec(this),countclick(),priceclick()" >全选</li>
					<li>商品</li>
					<li>参数</li>
					<li>单价</li>
					<li>数量</li>
					<li>小计</li>
					<li>操作</li>
				</ul>
			</div>
			<br>
			<div class="cartbody">
                {% for cartitem in cartitemlist %}
                    <div class="cartbodyul"  goodsid="{{ cartitem.goodsid }}" sizeid="{{ cartitem.sizeid }}" colorid="{{ cartitem.colorid }}">
                        <li>
                            <input type="checkbox" class="chec" checked="checked" onclick="countclick(),priceclick(),onesec()" >
                            <img src="/{{ cartitem.getcolor.colorurl}}" width="90px" >
                        </li>
                        <li>{{ cartitem.getgoods.gname}}</li>
                        <li>&emsp{{ cartitem.getcolor.colorname}}-{{ cartitem.getsize.sname}}</li>
                        <li>￥{{ cartitem.getgoods.price}}</li>
                        <li>
                            <a class="cartcount" >{{ cartitem.count }}</a>
{#                            &nbsp;<input  value="{{ cartitem.count }}" style="width: 40px">&emsp;#}
                        </li>
                        <li class="cartprice" >￥{{ cartitem.gettotalprice }}</li>
                        <li>
{#                            获取商品的id进行动态传参#}
                            <a href="/cart/deletequery/{{ cartitem.id }}" >移除商品</a>
                        </li>
				    </div>
                {% endfor %}
                

                
			</div>
				<br>
			<div class="cartfoot">
				<div class="cartfootul">

					<li ><a href="/good/" style="text-decoration: none;">返回首页</a></li>
					<li style="margin-left: 630px;">商品件数：<span class="allcount" >0</span></li>
					<li  style="margin-left: 100px;" >总价：￥<span class="allprice" >0.00</span></li>
					<li style="margin-left: 150px;">
                        <a href=""  class="submit"   >结算</a>
{#						<input type="submit" value="结算" class="submit" style="width: 100px;height: 50px;background-color: aliceblue;" />#}
					</li>
				</div>
			</div>
			<br>
        </div>

{% endblock %}

{% block footerjs %}
    <script>
        {#function mvquery(thi){#}
        {#    var div=thi.parentNode.parentNode;#}
        {#    div.remove();}#}

{#        获取商品数量和总价#}
        $(function (){
            var chek=$('.chec')
            var coun=0
            for (var i=0;i<chek.length;i++){

                 if (chek[i].checked){
                     var c=$('.cartcount')
                     var cou=c.text()
                     co=cou[i]
                     coun=coun+Number(co)
                }
            }
            $('.allcount').text(coun)
        })
        function countclick(){
            var chek=$('.chec')
            var coun=0
            for (var i=0;i<chek.length;i++){

                 if (chek[i].checked){
                     var c=$('.cartcount')
                     var cou=c.text()
                     co=cou[i]
                     coun=coun+Number(co)
                }
            }
            $('.allcount').text(coun)
        }
        {#价格#}
        $(function (){
            var chek=$('.chec')
            var coun=0
            var c=$('.cartprice')
            for (var i=0;i<chek.length+1;i++){

                var cou=c.text()
                {#分割获取的文本#}
                co=cou.split('￥')[i]
                coun=coun+Number(co)
            }
            $('.allprice').text(coun)
        })
        function priceclick(){
            var chek=$('.chec')
            var coun=0
            var c=$('.cartprice')
            for (var i=0;i<chek.length;i++){
                if (chek[i].checked){
                    var cou=c.text()
                    {#分割获取的文本#}
                    co=cou.split('￥')[i+1]
                    coun=coun+Number(co)
                }
            }
            $('.allprice').text(coun)
        }

    {#    全选#}
        function allsec(thi) {
            var chec = $('.chec')
            var flag = thi.checked;

            if (flag) {
                for (var i=0;i<chec.length;i++){
                    chec[i].checked = true;
                }

            }
            else {
                for (var i=0;i<chec.length;i++){
                    chec[i].checked = false;
                }
            }
        }
    {#    单选#}
        function onesec() {
            var chec = $('.chec')
            var checa = $('.checa')
            var flag = false

            for (var i=0;i<chec.length;i++){
                if (!chec[i].checked){
                    checa[0].checked=false
                    break
                }
                else {
                    checa[0].checked=true
                }
            }
        }

        {#单机结算#}
        $('.submit').click(function (){
            {#所选商品列表#}
            var cartitems=[]
            {#获取列表中checkbox#}
            var cks=$('.chec')
            {#each遍历 index序号 ck对象#}
            $.each(cks,function (index,ck) {
                {#prop\atter 都获取一个标签里的属性#}
                if ($(ck).prop('checked')) {
                    var goodsid = $(ck).parents('.cartbodyul').attr('goodsid')
                    var sizeid = $(ck).parents('.cartbodyul').attr('sizeid')
                    var colorid = $(ck).parents('.cartbodyul').attr('colorid')
                    {#将获取的属性值放入#}
                    cartitems.push({'goodsid': goodsid, 'sizeid': sizeid, 'colorid': colorid})

                }
            })
            {#判断用户是否选中商品#}
            if (cartitems.length==0){
                return
            }

            {#置换指定链接,将信息序列化后,传递购物车参数#}
            $(this).attr('href','/order/?cartitems='+JSON.stringify(cartitems))



        })




    </script>
{% endblock %}







